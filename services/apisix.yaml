# ==========================================
# apisix.yaml
# ==========================================

upstreams:
  - id: auth_service
    type: roundrobin
    nodes:
      "auth-service:5001": 1

  - id: matchmaking_service
    type: roundrobin
    nodes:
      "matchmaking-service:4000": 1

routes:
  # Public route for login/register
  - id: auth_route
    uris:
      - /api/auth/*
    upstream_id: auth_service

  # Protected route — requires JWT
  - id: matchmaking_route
    uris:
      - /api/matchmaking/*
    upstream_id: matchmaking_service
    plugins:
      jwt-auth:
        algorithm: HS256                 # ✅ Match your JWT signing algorithm (HS256, RS256, etc.)
        secret: "mysuperlongsharedsecretkey123456"            # ✅ Must match the secret used to sign JWTs
        header: Authorization             # ✅ Default, but you can change
        query: jwt                        # Optional: allow ?jwt=token
        cookie: jwt                       # Optional: allow cookies
#        validate_consumer: false
        claims_to_verify:
          - exp
          - nbf
      proxy-rewrite:
        regex_uri: [ "^/api/(.*)", "/$1" ]

consumers:
  - username: default
    plugins:
      jwt-auth:
        key: default
        secret: "mysuperlongsharedsecretkey123456"
#END